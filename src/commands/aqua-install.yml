description: >
  Install clivm.
parameters:
  clivm_root_dir:
    type: string
    description: >
      clivm's root directory.
  clivm_install_path:
    type: string
    default: /usr/local/bin/clivm
    description: >
      clivm install path
  config:
    type: string
    default: clivm.yaml
    description: >
      clivm's configuration file path.
  cache_version:
    type: string
    default: v1
    description: >
      cache version.
steps:
  - restore_cache:
      keys:
        - clivm-tools-<< parameters.cache_version >>-{{ checksum "<< parameters.config >>" }}
        - clivm-tools-<< parameters.cache_version >>-
  - run:
      command: |
        export "CLIVM_ROOT_DIR=<< parameters.clivm_root_dir >>"
        "<< parameters.clivm_install_path >>" -c "<< parameters.config >>" i
  - run:
      command: |
        if [ -n "${BASH_ENV:-}" ]; then
          echo 'export "CLIVM_ROOT_DIR=<< parameters.clivm_root_dir >>"' >> $BASH_ENV
          echo 'export "PATH=<< parameters.clivm_root_dir >>/bin:$PATH"' >> $BASH_ENV
        fi
  - save_cache:
      key: clivm-tools-<< parameters.cache_version >>-{{ checksum "<< parameters.config >>" }}
      paths:
        - << parameters.clivm_root_dir >>
